/**
 * JavaScript for PHP Report Maker 12
 * @license (C) 2007-2019 e.World Technology Ltd.
 */
jQuery.extend(ew,function(e,t){var e=jQuery,a,r={},n=200,i=150,o=200,l="##empty##",s="##null##";window.exportCharts={};window.drillDownCharts={};function p(a,r,n){var i=e(r),o=e(r.rows);if(!r||!r.rows||!n&&i.data("isset")||r.tBodies.length==0)return;var l=o.filter("[data-rowindex=1]").length||o.filter("[data-rowindex=0]").length||1;var s=o.filter(":not(."+t.ITEM_TEMPLATE_CLASSNAME+"):not(:hidden)").each(function(){e(this.cells).removeClass(t.TABLE_LAST_ROW_CLASSNAME).last().addClass(t.TABLE_LAST_COL_CLASSNAME)}).get();var p=i.parentsUntil(".ew-grid",".table-responsive")[0];if(s.length){for(var d=1;d<=l;d++){var c=s[s.length-d];e(c.cells).each(function(){if(this.rowSpan==d)e(this).addClass(t.TABLE_LAST_ROW_CLASSNAME).toggleClass(t.TABLE_BORDER_BOTTOM_CLASSNAME,!!p&&p.offsetHeight>r.offsetHeight)})}}t.setupGrid(a,i.closest("."+t.GRID_CLASSNAME)[0],n);i.data("isset",true)}function d(a){var r=a&&a.target?a.target:document,n=e(r).find("."+t.REPORT_CONTAINER_ID);n.find("div.ew-table-header-btn").each(function(){var a=e(this),r=0;a.find(".ew-table-header-sort:has(.fa), .ew-table-header-popup").each(function(){r+=e(this).width()});if(r)a.css(t.CSS_FLIP?"padding-left":"padding-right",r+4)});n.find("table."+t.TABLE_CLASSNAME+":not(.ew-export-table)").each(t.setupReport);n.find("table."+t.GRID_CLASSNAME+":not(.ew-export-table)").each(t.setupGrid);n.find(".card").on("collapsed.lte.widget",function(){var t=e(this),a=t.closest("[class^='col-']"),r=a.css("min-height");if(r)a.data("min-height",r);a.css("min-height",0)}).on("expanded.lte.widget",function(){var t=e(this),a=t.closest("[class^='col-']"),r=a.css("min-height");if(r)a.css("min-height",r)})}e(function(){d()});function c(e){var a=t.currentPage();return a.substring(0,a.lastIndexOf("/")+1)+e}function f(a,r,n,i){var o=a.target;n+="_"+(new Date).getTime();r+=(r.split("?").length>1?"&":"?")+"exportid="+n;r=c(r);var l=e(o),s=i?"post":"get";if(l.is(".dropdown-menu a"))l=l.closest(".btn-group");var p=function(){if(i&&!/&(amp;)?custom=1/.test(r)){data=e(i).serialize();data+="&token="+t.ANTIFORGERY_TOKEN;e.post(r,data,function(e){t.showMessage(e)})}else{if(/export=(word|excel|pdf|email)&(amp;)?custom=1/.test(r)){if(/export=email/.test(r)){r=r.replace(/export=email&(amp;)?/i,"");r+="&"+e(i).serialize()}e("iframe.ew-export").remove();e("<iframe></iframe>").addClass("ew-export d-none").attr("src",r).appendTo(e("body").css("cursor","wait"));e.later(5e3,null,function(){e("body").css("cursor","default")})}else if(/export=print/.test(r)){t.redirect(r,i,s)}else{t.fileDownload(r,null)}}};var d=Object.keys(window.exportCharts);if(d.length==0)return p();var f=function(a){if(e.isString(a)){try{a=e.parseJSON(a)}catch(e){}}if(a.success){p()}else{t.alert(a.error)}};var u=function(e,a,r){t.alert(r+": "+e.responseText)};var h=[];for(var m=0;m<d.length;m++){var v=d[m],g=window.exportCharts[v],b=e.Deferred(),E="exportfilename="+n+"_"+v+".png|exportformat=png|exportaction=download|exportparameters=undefined";h.push(b);if(g&&g.draw){if(g.getImageURI){b.resolve({chart_engine:"google",stream_type:"base64",stream:g.getImageURI(),parameters:E})}else{var _=e("#div_"+v.substr(6)).find("svg").parent().html();b.resolve({chart_engine:"google",stream_type:"svg",stream:_,parameters:E})}}else if(g instanceof FusionCharts){g.getSVGString(e.proxy(function(e){this.dfd.resolve({chart_engine:"fusioncharts",stream_type:"svg",stream:e,meta_bgColor:"#ffffff",meta_bgAlpha:"1",meta_DOMId:this.id,parameters:this.params})},{dfd:b,id:v,params:E}))}}e("body").css("cursor","wait");e.when.apply(null,h).done(function(){e.ajax({url:t.API_URL,data:{action:"exportchart",token:t.ANTIFORGERY_TOKEN,charts:JSON.stringify(e.makeArray(arguments))},cache:false,type:"POST"}).done(f).fail(u).always(function(){e("#ew-message-box").find(".modal-footer button").prop("disabled",false);e("body").css("cursor","default")})})}function u(e,a){t.popups[e]=a}function h(a,r){a.stopPropagation();var n=e(this).tooltip("hide"),i=r.name,o=r.id,l=r.form,s=t.forms(l).lists[o],p=s.popupValues,d=r.range,c=r.from,f=r.to;var u=function(){var a=e(n.data("bs.popover").getTipElement()),r=a.find("form")[0];var o=e('<button type="button" class="btn btn-primary btn-sm ew-popup-btn">'+t.language.phrase("MessageOK")+"</button>").click(function(){if(r&&!t.selectedEntry(r,i)){t.alert(t.language.phrase("PopupNoValue"))}else{if(r)r.submit();n.popover("hide")}});a.find(".modal-footer").append(o).removeClass("d-none")};var h=function(){var a=e(n.data("bs.popover").getTipElement()),r=a.find("form")[0];var i=e('<button type="button" class="btn btn-default btn-sm ew-popup-btn">'+t.language.phrase("Cancel")+"</button>").click(function(){n.popover("hide")});a.find(".modal-footer").append(i)};if(!n.data("bs.popover")){n.popover({html:true,placement:"bottom",trigger:"manual",template:'<div class="popover"><div class="popover-body p-2" style="overflow: auto;"></div><div class="modal-footer p-2 d-none"></div></div>',content:'<div class="ew-loading"><div class="ew-spinner"><div></div></div> '+t.language.phrase("Loading").replace("%s","")+"</div>",container:e("#ew-popup-filter-dialog")[0]}).on("shown.bs.popover",function(a){if(s.popupOptions&&e.isArray(s.popupOptions)&&s.popupOptions.length)t.popups[i]=s.popupOptions;if(t.popups[i]){t.setPopupContent.call(n[0],i,t.popups[i],p,d,c,f);u();h()}else{var r=e.extend(true,{},s,{values:null,options:null,popupValues:null,template:null,ajax:"popup",token:t.ANTIFORGERY_TOKEN},t.getUserParams("#p_"+o));r[t.API_ACTION_NAME]=t.API_LOOKUP_ACTION;e.ajax({cache:false,dataType:"json",type:"POST",data:r,url:t.API_URL,success:function(a){if(e.isObject(a)&&a.result=="OK"){var r=n.data("args");t.createPopup(r.popupname,a.records);t.setPopupContent.call(n[0],r.popupname,a.records,p,r.useRange,r.rangeFrom,r.rangeTo);u();h()}},error:function(t){if(t.responseText){var a=e(n.data("bs.popover").getTipElement());a.find(".popover-body").empty().append('<p class="text-danger">'+t.responseText+"</p>");a.find(".modal-footer").empty();u()}}})}})}n.data("args",{popupname:i,useRange:d,rangeFrom:c,rangeTo:f}).popover("show")}function m(a,r,n,i,o,l){var s=e.isArray(n)?n.length:0,p=e(this);var d=s==0,c=false,f=d?" checked":"";var u=e('<form id="'+a+'-filter-form" class="ew-filter-form" method="post">'+'<input type="hidden" name="token" value="'+t.ANTIFORGERY_TOKEN+'">'+'<input type="hidden" name="popup" value="'+a+'">'+'<div class="ew-popup-container"></div></form>');if(i){u.append('<div class="form-group"><label for="rf_'+a+'">'+t.language.phrase("PopupFrom")+"</label>"+'<select class="custom-select" id="rf_'+a+'" name="rf_'+a+'" onchange="ew.selectRange(this, \''+a+"');\">"+"</select></div>"+'<div class="form-group"><label for="rt_'+a+'">'+t.language.phrase("PopupTo")+"</label>"+'<select class="custom-select" id="rt_'+a+'" name="rt_'+a+'" onchange="ew.selectRange(this, \''+a+"');\">"+"</select></div>");var h=u.find("select").first();h.append('<option value="">'+t.language.phrase("PopupSelect")+"</option>");e.map(r,function(a){var r=String(a["lf"]),n=e.isValue(a["df"])?String(a["df"]):r;if(!r.startsWith("@@")&&r!=t.NULL_VALUE&&r!=t.EMPTY_VALUE){var i=r==o?" selected":"";h.append('<option value="'+r+'"'+i+">"+n+"</option>")}});var h=u.find("select").last();h.append('<option value="">'+t.language.phrase("PopupSelect")+"</option>");e.map(r,function(a){var r=String(a["lf"]),n=e.isValue(a["df"])?String(a["df"]):r;if(!r.startsWith("@@")&&r!=t.NULL_VALUE&&r!=t.EMPTY_VALUE){selected=r==l?" selected":"";h.append('<option value="'+r+'"'+selected+">"+n+"</option>")}});u.append("<hr>")}u.append('<div class="custom-control custom-checkbox ew-popup-item"><input type="checkbox" class="custom-control-input" id="sel_'+a+'" name="sel_'+a+'[]" value="" onclick="ew.selectAll(this);"'+f+">"+'<label class="custom-control-label" for="sel_'+a+'">'+t.language.phrase("PopupAll")+"</label></div>");e.map(r,function(t,r){var i=String(t["lf"]),o=e.isValue(t["df"])?String(t["df"]):i,l=!e.isArray(n)||e.inArray(i,n)>-1?" checked":"";if(i.startsWith("@@")){c=true}else if(c){c=false;u.append("<hr>")}u.append('<div class="custom-control custom-checkbox ew-popup-item"><input type="checkbox" class="custom-control-input" id="sel_'+a+"_"+r+'" name="sel_'+a+'[]" value="'+i+'" onclick="ew.updateSelectAll(this);"'+l+'><label class="custom-control-label" for="sel_'+a+"_"+r+'">'+o+"</label></div>")});var m=e(p.data("bs.popover").getTipElement());m.find(".popover-body").empty().append(u);m.find(".modal-footer").empty()}function v(t,a){var r=e(t.elements["sel_"+a+"[]"]);return r.length>0?r.filter(":not(:first):checked").length>0:r.prop("checked")}function g(a){t.clearRange(a);e(a.form.elements).filter("input:checkbox[name='"+a.name+"']:not(:first)").prop("checked",a.checked)}function b(a){t.clearRange(a);var r=a.form;if(r){var n=r.elements[a.name][0];if(n){var i=e(a.form.elements).filter("input:checkbox[name='"+a.name+"']:not(:first)"),o=i.length,l=i.filter(":checked").length;e(n).prop("checked",o==l).prop("indeterminate",l>0&&o>l)}}}function E(a){var r,n,i=a.form,o=a.name.replace(/^r[ft]_/,"");if(i.elements["rf_"+o].selectedIndex>-1)r=i.elements["rf_"+o].options[i.elements["rf_"+o].selectedIndex].value;if(i.elements["rt_"+o].selectedIndex>-1)n=i.elements["rt_"+o].options[i.elements["rt_"+o].selectedIndex].value;if(!e.isValue(r)||!e.isValue(n)||r===""||n==="")return;t.setRange(a,r,n,true)}function _(e){var a=e.form,r=e.name.replace(/^sel__/,"").replace(/\[\]$/,"");var n=a.elements["rf_"+r],i=a.elements["rt_"+r];if(n&&i&&n.selectedIndex>0&&i.selectedIndex>0){n.selectedIndex=0;i.selectedIndex=0;t.setRange(e,n.options[n.selectedIndex].value,i.options[i.selectedIndex].value,false)}}function w(t,a,r,n){var i=t.form,o=t.name.replace(/^r[ft]_/,"sel_")+"[]",l;e(i.elements).filter("input:checkbox[name='"+o+"']").each(function(){if(this.value==a)l=true;if(l)this.checked=n;else if(n)this.checked=false;if(this.value==r)l=false})}function y(e){this.name=e;this.pageId="";this.validateRequired=true}t.Form.prototype.searchOperatorChanged=function(t){var a=this.getForm(),r=e(a),n=e.isString(t)?a.elements[t]:t;if(!n)return;var i=n.id.substr(2),o=e(n).val(),l=o=="BETWEEN",s=o=="IS NULL"||o=="IS NOT NULL";if(/^z_/.test(n.id))r.find("[name^=x_"+i+"],[name^=cal_x_"+i+"]").prop("disabled",s);if(/^w_/.test(n.id))r.find("[name^=y_"+i+"],[name^=cal_y_"+i+"]").prop("disabled",s);r.find("span.btw0_"+i).toggleClass("d-none",l).end().find("span.btw1_"+i).toggleClass("d-none",!l).find(":input").prop("disabled",!l)};t.Form.prototype.preSubmit=function(){var t=this.getForm(),a=e(t);a.find("input[name^=s_],input[name^=sv_],input[name^=q_]").prop("disabled",true);a.find("input[name$='[]'][data-multiple='1']").each(function(){var t=e(this),r=t.attr("id"),n=t.val().split(",");e.each(n,function(e,n){t.clone().attr("id",r+e).val(n).appendTo(a)})}).remove()};t.Form.prototype.submit=function(t){var a=this.getForm(),r=e(a);this.disableForm();if(!this.validate||this.validate()){if(t)a.action=t;this.preSubmit();a.submit()}else{this.enableForm()}return false};t.Form.prototype.getFormData=function(){var a=this.getForm(),r=e(a);if(t.hasFormData(a)){this.preSubmit();return r.serialize()}return""};t.Form.prototype.setupFilters=function(a,r){var n=this.id,i=this.filterList,o=e(".ew-save-filter[data-form="+n+"]"),l=e(".ew-delete-filter[data-form="+n+"]"),s=l.parent("li").toggleClass("dropdown-submenu",!!r.length).toggleClass("disabled",!r.length),p=o.parent("li").toggleClass("disabled",!i),d=e(a.target);p.off("click.ew").on("click.ew",function(a){if(p.hasClass("disabled"))return false;t.prompt(t.language.phrase("EnterFilterName"),function(t){r[r.length]=[t,i];e.localStorage.set(n+"_filters",r)},true);return false}).prevAll().remove();l.next("ul.dropdown-menu").remove();if(r.length){$menu=l.closest("ul.dropdown-menu");$submenu=e("<ul class='dropdown-menu'></ul>");for(var c in r){if(!e.isArray(r[c]))continue;e("<li><a data-index='"+c+"' href='#'>"+r[c][0]+"</a></li>").on("click",function(a){var i=e(this).find("a[data-index]").data("index");t.prompt(t.language.phrase("DeleteFilterConfirm").replace("%s",r[i][0]),function(){delete r[i];e.localStorage.set(n+"_filters",r)});return false}).appendTo($submenu);e("<li><a class='ew-filter-list' data-index='"+c+"' href='#'>"+r[c][0]+"</a></li>").insertBefore(p).on("click",function(a){var n=e(this).find("a[data-index]").data("index");e("<form>").attr({method:"post",action:location.href.split("?")[0]}).append(e("<input type='hidden'>").attr({name:"cmd",value:"resetfilter"}),e("<input type='hidden'>").attr({name:"token",value:t.ANTIFORGERY_TOKEN}),e("<input type='hidden'>").attr({name:"filter",value:JSON.stringify(r[n][1])})).appendTo("body").submit();return false})}e("<li class='divider'></li>").insertBefore(p);s.append($submenu)}};function x(t){var a=e(t).find("[name^=x_][value!=''][value!='{value}'],[name^=y_][value!=''][value!='{value}']").get();for(var r=0,n=a.length;r<n;r++){var i=a[r];if(/^(so|so2)_/.test(i.name)){if(/^IS/.test(e(i).val()))return true}else if(i.type=="checkbox"||i.type=="radio"){if(i.checked)return true}else if(i.type=="select-one"||i.type=="select-multiple"){for(var o=0,l=i.options.length;o<l;o++){if(i.options[o].selected&&i.options[o].value!=""&&i.options[o].value!="##all##")return true}}else if(i.type=="text"||i.type=="hidden"||i.type=="textarea"){return true}}return false}function A(a){if(a.options){var r=1;for(var n=a.length-1;n>=r;n--)if(!a.options[n].value.startsWith("@@"))a.options[n]=null}else if(a.length){var i=t.getId(a),o=t.getElement("dsl_"+i,a[0].form);e(o).data("options",[]).find("div").first().empty();for(var n=0;n<a.length;n++){var l=a[n];var s=l.value;if(s.startsWith("@@")){var p=e(l).data("filter-name");if(p){var d=e(o).data("options");d[d.length]={val:s,lbl:p};e(o).data("options",d)}}}}else if(t.isAutoSuggest(a)){var c=t.getAutoSuggest(a);c._options=[];c.input.value="";a.value=""}else if(t.isModalLookup(a)){e(a).data("options",[])}}function T(a){var r=t.getId(a),n=t.getForm(a),i=e(a).parent().parent().find("#dsl_"+r);if(!i[0]||!i.data("options"))return;var o=i.parent().find("#tp_"+r);if(!o[0])return;var l=!t.IS_MOBILE?parseInt(i.data("repeatcolumn"),10)||5:1;var s=o.contents(),p=i.data("options"),d=s.attr("type");var c=i.prevAll(".dropdown-toggle"),f=i.prevAll(".ew-dropdown-list-clear");if(p&&p.length){if(l>1||d=="checkbox"||!c[0]){var u=e('<table class="ew-item-table"></table>');if(d=="checkbox")u.click(function(e){e.stopPropagation()});for(var h=0,m=p.length;h<m;h++){if(h%l==0)$tr=e("<tr></tr>");var v=s.clone(true).val(p[h].val).click(function(a){if(c[0]){var r=u.find("input[name='"+this.name+"']:checked");var n=r.map(function(){return e(this).parent().text()}).get();var i=n.length>(e(this).data("maxcount")||3)?t.language.phrase("CountSelected").replace("%s",n.length):n.join(", ");c.html(n.length?i:t.language.phrase("PleaseSelect"));f.toggle(n.length>0)}});var g=e('<label class="'+d+'-inline"></label>').append(v.attr("id",v.attr("id")+"_"+h),p[h].lbl);var b={name:r,form:n,value:p[h].val,text:p[h].lbl,option:g};e(document).trigger("newoption",[b]);e("<td></td>").append(b.option).appendTo($tr);if(h%l==l-1){u.append($tr)}else if(h==m-1){for(var E=h%l+1;E<l;E++)$tr.append("<td></td>");u.append($tr)}}i.find("div").first().append(u)}else{var _=e('<div class="list-group"></div>');for(var h=0,m=p.length;h<m;h++){var v=s.clone(true).val(p[h].val).click(function(a){var r=e(this).closest(".list-group-item");if(r.hasClass("active"))this.checked=false;r.siblings(".list-group-item").removeClass("active");r.toggleClass("active",this.checked);c.html(this.checked?r.text():t.language.phrase("PleaseSelect"));f.toggle(this.checked)});var g=e('<label class="'+d+'-inline"></label>').append(v.attr("id",v.attr("id")+"_"+h),p[h].lbl);var w=e('<a class="list-group-item" href="#"></a>').append(g);var b={name:r,form:n,value:p[h].val,text:p[h].lbl,option:w};e(document).trigger("newoption",[b]);_.append(b.option)}i.find("div").first().append(_)}var y=e.trim(c.html());f.toggle(!!y&&y!=t.language.phrase("PleaseSelect")).off().click(function(e){i.find("[data-field]:radio,[data-field]:checkbox").prop("checked",false).first().triggerHandler("click");i.find(".list-group-item.active").removeClass("active");c.html(t.language.phrase("PleaseSelect"));f.hide()})}i.data("options",[])}function S(a,r){if(!a||!r||r.length==0)return;var n=e(a);if(a.options){n.val(r);if(a.type=="select-one"&&a.selectedIndex==-1)a.selectedIndex=0}else if(a.length){if(a.length==1&&a[0].type=="checkbox"&&a[0].value!="{value}"){a[0].checked=ConvertToBool(a[0].value)===ConvertToBool(r[0])}else{n.val(r).closest(".ew-dropdown-list").find(".ew-dropdown-list-clear").show();n.each(function(){e(this).closest(".list-group-item").toggleClass("active",this.checked)})}}else if(t.isAutoSuggest(a)&&r.length==1){var i=t.getAutoSuggest(a);for(var o=0,l=i._options.length;o<l;o++){if(i._options[o].val==r[0]){a.value=i._options[o].val;i.input.value=i._options[o].lbl;break}}}else if(t.isModalLookup(a)){var n=e(a),s="",p="",d=n.data("options")||[];for(var c=0,f=r.length;c<f;c++){for(var o=0,l=d.length;o<l;o++){if(r[c]==d[o].val){s+=(s!==""?t.LOOKUP_FILTER_VALUE_SEPARATOR:"")+d[o].val;p+=(p!==""?", ":"")+d[o].lbl;break}}}n.val(s);n.parent().find(".ew-lookup-text").html(p!==""?p:t.language.phrase("PleaseSelect"))}else if(a.type){a.value=r.join(",")}function u(a){if(!e(a).data("autoselect"))return false;var r=t.getForm(a);if(r){if(/s(ea)?rch$/.test(r.id))return false;var n=a.id.replace(/^([xy])(\d*)_/,"x_");if(n in t.forms[r.id].lists&&t.forms[r.id].lists[n].parentFields.length==0)return false;return true}return false}if(a.options){if(a.type=="select-one"&&a.options.length==2&&!a.options[1].selected&&u(a)){a.options[1].selected=true}else if(a.type=="select-multiple"&&a.options.length==1&&!a.options[0].selected&&u(a)){a.options[0].selected=true}}else if(a.length){if(a.length==2&&u(a[1]))a[1].checked=true}else if(t.isAutoSuggest(a)){var i=t.getAutoSuggest(a);if(i._options.length==1&&u(a)){a.value=i._options[0].val;i.input.value=i._options[0].lbl}}}function I(a){e(a).find("[id^=x_],[id^=y_]").each(function(){if(this.type=="checkbox"||this.type=="radio"){this.checked=false}else if(this.type=="select-one"){this.selectedIndex=0}else if(this.type=="select-multiple"){e(this).find("option").prop("selected",false)}else if(this.type=="text"||this.type=="textarea"){this.value="";if(t.isAutoSuggest(this))t.getAutoSuggest(this).input.value=""}})}function C(a){var r=t.emailDialog||e("#ew-email-dialog");if(!r[0]){_alert("DIV #ew-email-dialog not found.");return}var n=r.find(".modal-body form").data("args",a);var i=n.data("form");if(!i){i=new t.Form(n.attr("id"));i.validate=function(){var e,a=this.getForm();e=a.elements["sender"];if(e&&!t.hasValue(e))return this.onError(e,t.language.phrase("EnterSenderEmail"));if(e&&!t.checkEmails(e.value,1))return this.onError(e,t.language.phrase("EnterProperSenderEmail"));e=a.elements["recipient"];if(e&&!t.hasValue(e))return this.onError(e,t.language.phrase("EnterRecipientEmail"));if(e&&!t.checkEmails(e.value,t.MAX_EMAIL_RECIPIENT))return this.onError(e,t.language.phrase("EnterProperRecipientEmail"));e=a.elements["cc"];if(e&&!t.checkEmails(e.value,t.MAX_EMAIL_RECIPIENT))return this.onError(e,t.language.phrase("EnterProperCcEmail"));e=a.elements["bcc"];if(e&&!t.checkEmails(e.value,t.MAX_EMAIL_RECIPIENT))return this.onError(e,t.language.phrase("EnterProperBccEmail"));e=a.elements["subject"];if(e&&!t.hasValue(e))return this.onError(e,t.language.phrase("EnterSubject"));return true};i.submit=function(){if(!this.validate())return false;var a=this.getForm(),n=e(a),i=n.data("args");if(i.url&&i.exportid){r.modal("hide");f(i.el,i.url,i.exportid,a)}else{var o=n.serialize();o+="&token="+t.ANTIFORGERY_TOKEN;e.post(a.action,o,function(e){t.showMessage(e)});r.modal("hide")}return false};n.data("form",i)}r.modal("hide").find(".modal-title").html(a.hdr);r.find(".modal-footer .btn-primary").unbind().click(function(e){e.preventDefault();if(i.submit())r.modal("hide")});t.emailDialog=r.modal("show")}function k(a){var r=t.reportUrlDialog||e("#ew-report-url-dialog"),n=e(".ew-ext-filter-form");if(!r)return;var i=function(){l=[];if(n){var t=n.attr("id");var a=e.localStorage.get(t+"_filters")||[];var r=e.grep(a,function(t){if(e.isArray(t)&&t.length==2)return t});if(r.length){for(var i in r){if(!e.isArray(r[i]))continue;l[l.length]=r[i]}}}return l};var o=r.find(".modal-body form");o.find("#ew-report-type").off("change.ew").on("change.ew",function(){o.find(".ew-report-email").toggleClass("d-none",e(this).val()!="email")}).triggerHandler("change");o.find("#ew-url").val("");var l=i();for(var s=0,p=l.length;s<p;s++)o.find("#ew-filter-name").find(".ew-filter").remove().end().append(e("<option>",{class:"ew-filter",value:l[s][0],text:l[s][0]}));var d=o.data("form");if(!d){d=new t.Form(o.attr("id"));d.validate=function(){var e,a=this.getForm();e=a.elements["sender"];if(e&&!t.hasValue(e))return this.onError(e,t.language.phrase("EnterSenderEmail"));if(e&&!t.checkEmails(e.value,1))return this.onError(e,t.language.phrase("EnterProperSenderEmail"));e=a.elements["recipient"];if(e&&!t.hasValue(e))return this.onError(e,t.language.phrase("EnterRecipientEmail"));if(e&&!t.checkEmails(e.value,t.MAX_EMAIL_RECIPIENT))return this.onError(e,t.language.phrase("EnterProperRecipientEmail"));e=a.elements["cc"];if(e&&!t.checkEmails(e.value,t.MAX_EMAIL_RECIPIENT))return this.onError(e,t.language.phrase("EnterProperCcEmail"));e=a.elements["bcc"];if(e&&!t.checkEmails(e.value,t.MAX_EMAIL_RECIPIENT))return this.onError(e,t.language.phrase("EnterProperBccEmail"));e=a.elements["subject"];if(e&&!t.hasValue(e))return this.onError(e,t.language.phrase("EnterSubject"));return true};d.submit=function(){var a=this.getForm(),r=e(a);var i=t.getOptionValues("reporttype",a);var o=t.getOptionValues("filtername",a);if(i=="email"&&!this.validate())return false;var s=r.serialize();if(o!=""){if(o=="@@current"){var p=n.attr("id")?t.forms[n.attr("id")]:null;if(p&&p.filterList)s+="&filter="+JSON.stringify(p.filterList)}else{for(var d=0,c=l.length;d<c;d++){if(l[d][0]==o)s+="&filter="+JSON.stringify(l[d][1])}}}s+="&"+t.API_ACTION_NAME+"=generatereporturl&rnd="+t.random();e.post(t.API_URL,s,function(t){var a,n;if(e.isString(t)){try{a=e.parseJSON(t)}catch(e){}}else if(e.isObject(t)){a=t}if(e.isObject(a)&&a.url){n=a.url;r.find("#ew-url").val(n)}});return false};o.data("form",d)}var c=e(a.currentTarget);r.modal("hide").find(".modal-title").html(c.data("original-title")||c.attr("title"));r.find(".modal-footer .btn-primary").unbind().click(function(e){e.preventDefault();d.submit()});var f=r.find(".modal-footer .ew-copy-to-clipboard");if(!f.data("clipboard"))f.data("clipboard",new ClipboardJS(f[0]));t.reportUrlDialog=r.modal("show")}function O(a,r,n,i,o){if(a&&a.ctrlKey){t.redirect(n.replace("?d=1&","?d=2&"));return false}var l=e.isString(r)?e("#"+r):e(r);var s=l.data("drilldown-placement")||(l.hasClass("ew-chart-div")?t.CSS_FLIP?"left":"right":"bottom");l.tooltip("hide");var p={obj:l[0],id:i,url:n,hdr:o,placement:s};e(document).trigger("drilldown",[p]);var d=p.url.split("?");p.file=d[0]||"";p.data=d[1]||"";p.data+=(p.data?"&":"")+"token="+t.ANTIFORGERY_TOKEN;if(!l.data("bs.popover")){l.popover({html:true,placement:p.placement,trigger:"manual",template:'<div class="popover"><h3 class="popover-header d-none" style="cursor: move;"></h3><div class="popover-body"></div></div>',content:'<div class="ew-loading"><div class="ew-spinner"><div></div></div> '+t.language.phrase("Loading").replace("%s","")+"</div>",container:e("#ew-drilldown-panel")}).on("show.bs.popover",function(e){l.attr("data-original-title","")}).on("shown.bs.popover",function(a){if(!l.data("args"))return;e.ajax({cache:false,dataType:"html",type:"POST",data:l.data("args").data,url:l.data("args").file,success:function(a){var r=e(l.data("bs.popover").getTipElement()).on("mousedown",function(t){var a=e(this).addClass("drag");var r=a.outerHeight();var n=a.outerWidth();var i=a.offset().top+r-t.pageY;var o=a.offset().left+n-t.pageX;e(document.body).on("mousemove",function(e){var t=e.pageY+i-r;var l=e.pageX+o-n;if(a.hasClass("drag"))a.offset({top:t,left:l})}).on("mouseup",function(e){a.removeClass("drag")})});if(p.hdr)r.find(".popover-header").empty().removeClass("d-none").append('<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+p.hdr).find(".close").click(function(){l.popover("hide")});var n=/<body[^>]*>([\s\S]*?)<\/body\s*>/i;if(a.match(n))a=RegExp.$1;var o=/<!--\s*Compat\s*header\s*starts\s*-->([\s\S]*?)<!--\s*Compat\s*header\s*ends\s*-->/i;a=a.replace(o,"");var s=t.stripScript(a);r.find(".popover-body").html(e("<div></div>").html(s).find("#ew-container")).find(".ew-table").each(t.setupTable);t.executeScript(a,i);l.popover("update")},error:function(t){if(t.responseText){var a=e($el.data("bs.popover").getTipElement());a.find(".popover-body").empty().append('<p class="text-danger">'+t.responseText+"</p>")}}})}).on("hidden.bs.popover",function(a){e.each(t.drillDownCharts,function(e,t){t.dispose()});t.drillDownCharts={};t.removeScript(i)})}l.data("args",p).popover("show")}function P(a,r,n,i,o){var l=e("#"+r);if(!e.views||!l[0])return;e("span[data-class^=tp],div[data-class^=tp]").html(function(){var t=e(this);return"<scr"+'ipt type="text/html" class="'+n+'" id="'+t.data("class")+'">'+t.html()+"</scr"+"ipt>"});if(!l.attr("type"))l.attr("type","text/html");var s={data:o||{},id:a,template:r,enabled:true};e(document).trigger("rendertemplate",[s]);if(s.enabled)e("#"+a).html(l.render(s.data));if(i&&i!="print"){e(function(){var r=e("meta[http-equiv='Content-Type']");var o="<html><head>";if(r[0])o+="<meta http-equiv='Content-Type' content='"+r.attr("content")+"'>";if(i=="pdf"){o+="<link rel='stylesheet' type='text/css' href='"+t.PDF_STYLESHEET_FILENAME+"'>"}else{o+="<style>"+e.ajax({async:false,type:"GET",url:t.PROJECT_STYLESHEET_FILENAME}).responseText+"</style>"}o+="</"+"head><body>";e("span.ew-chart-top").each(function(){o+=e(this).html()});o+=e("#"+a).find('div[id^="ct_"]').html();e("span.ew-chart-bottom").each(function(){o+=e(this).html()});o+="</body></html>";var l=window.location.href.split("?")[0];var s={customexport:i,data:o,filename:n};if(i=="email"){var p=window.location.search.replace(/^\?/,"")+"&"+e.param(s);p+="&token="+t.ANTIFORGERY_TOKEN;e.post(l,p,function(e){t.showMessage(e)})}else{t.fileDownload(l,s)}if(window.location!=window.parent.location&&window.parent.jQuery)window.parent.jQuery("body").css("cursor","default")})}}function L(t){var a=e(t),r=a.closest("tr"),n="tr",i;for(var o=1;o<=6;o++){var l=o==1?"":"-"+o;var s=r.data("group"+l);if(e.isValue(s)){i=o;if(s!="")n+="[data-group"+l+"='"+String(s).replace(/'/g,"\\'")+"']"}}if(a.hasClass("icon-collapse")){e(n).slice(1).addClass("ew-rpt-grp-hide-"+i);a.toggleClass("icon-expand icon-collapse")}else{e(n).slice(1).removeClass("ew-rpt-grp-hide-"+i);a.toggleClass("icon-expand icon-collapse")}}function R(a,r,n){if(!n||n.toLowerCase()=="post"){var i={},o=r?e(r):e("<form></form>").appendTo("body");o.attr({action:a.split("?")[0],method:"post"});a+=(a.split("?").length>1?"&":"?")+"token="+t.ANTIFORGERY_TOKEN;a.replace(/(?:\?|&)([^&=]*)=?([^&]*)/g,function(t,a,r){if(a)e('<input type="hidden">').attr({name:a,value:r}).appendTo(o)});o.submit()}else{window.location=a}}return{reportUrlDialog:a,popups:r,POPUP_MINWIDTH:n,POPUP_MINHEIGHT:i,POPUP_DEFAULTHEIGHT:o,EMPTY_VALUE:l,NULL_VALUE:s,setupReport:p,exportWithCharts:f,createPopup:u,showPopup:h,setPopupContent:m,selectedEntry:v,selectAll:g,updateSelectAll:b,selectRange:E,clearRange:_,setRange:w,page:y,hasFormData:x,clearOpt:A,renderOpt:T,selectOpt:S,clearForm:I,emailDialogShow:C,modalGenerateUrlShow:k,showDrillDown:O,applyTemplate:P,toggleGroup:L,redirect:R}}(jQuery,ew));